{% extends "base.html" %}

{% block title %}Admin - Manage Courses{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-book"></i> Manage Courses</h1>
        <p>Add, edit, and delete courses that will be available to teachers and students.</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="dashboard-section" style="margin-top:1.5rem;">
        <h2><i class="fas fa-plus-circle"></i> Add New Course</h2>
        <p class="section-subtitle">Fill out the fields below to add a new course.</p>
        <form method="POST" class="login-form">
            <input type="hidden" name="action" value="add">
            <div class="form-grid">
                <div class="form-group">
                    <label>Course Code *</label>
                    <input type="text" name="course_code" required placeholder="e.g., CS101">
                </div>
                <div class="form-group">
                    <label>Course Name *</label>
                    <input type="text" name="course_name" required placeholder="e.g., Introduction to Computer Science">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Description</label>
                    <textarea name="description" rows="3" placeholder="Optional course description"></textarea>
                </div>
            </div>
            <div style="margin-top:1rem;">
                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Course</button>
            </div>
        </form>
    </div>

    {% if courses %}
    <div class="dashboard-section">
        <h2><i class="fas fa-list"></i> Existing Courses</h2>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Course Code</th>
                        <th>Course Name</th>
                        <th>Description</th>
                        <th class="text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses %}
                    <tr>
                        <td><strong>{{ course.course_code }}</strong></td>
                        <td>{{ course.course_name }}</td>
                        <td>{{ course.description or 'â€”' }}</td>
                        <td class="text-right">
                            <button type="button" class="btn btn-xs btn-warning" 
                                    data-id="{{ course.id }}" 
                                    data-code="{{ course.course_code|e }}" 
                                    data-name="{{ course.course_name|e }}" 
                                    data-description="{{ course.description|e }}"
                                    onclick="editCourse(this)">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <form method="POST" style="display:inline;" onsubmit="return confirm('Delete this course? This cannot be undone if the course is not in use.');">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="course_id" value="{{ course.id }}">
                                <button type="submit" class="btn btn-xs btn-danger"><i class="fas fa-trash"></i> Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="dashboard-section">
        <div class="text-center" style="padding: 3rem;">
            <i class="fas fa-book fa-3x text-muted mb-3"></i>
            <h4 class="text-muted">No Courses Yet</h4>
            <p class="text-muted">Start by adding your first course above.</p>
        </div>
    </div>
    {% endif %}
</div>

<!-- Edit Course Modal -->
<div id="editModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div class="modal-dialog" style="position: relative; margin: 5% auto; width: 90%; max-width: 600px; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
        <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
            <h3 style="margin: 0;"><i class="fas fa-edit"></i> Edit Course</h3>
            <button type="button" onclick="closeEditModal()" style="float: right; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
        <form method="POST">
            <input type="hidden" name="action" value="edit">
            <input type="hidden" id="editCourseId" name="course_id">
            <div class="modal-body" style="padding: 1.5rem;">
                <div class="form-group">
                    <label>Course Code *</label>
                    <input type="text" id="editCourseCode" name="course_code" required>
                </div>
                <div class="form-group">
                    <label>Course Name *</label>
                    <input type="text" id="editCourseName" name="course_name" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="editDescription" name="description" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid #e5e7eb; text-align: right;">
                <button type="button" onclick="closeEditModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Update Course</button>
            </div>
        </form>
    </div>
</div>

<script>
function editCourse(button) {
    const id = button.dataset.id;
    const code = button.dataset.code;
    const name = button.dataset.name;
    const description = button.dataset.description;
    
    document.getElementById('editCourseId').value = id;
    document.getElementById('editCourseCode').value = code;
    document.getElementById('editCourseName').value = name;
    document.getElementById('editDescription').value = description;
    document.getElementById('editModal').style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target == modal) {
        closeEditModal();
    }
}
</script>
{% endblock %}
